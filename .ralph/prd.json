{
  "project": "Ralph Wiggum Technique - Enhancements",
  "description": "Using Ralph to improve Ralph - implementing advanced features for the Ralph Wiggum Technique",
  "schema_version": "2.0",
  "features": [
    {
      "id": "000a",
      "type": "feature",
      "category": "infrastructure",
      "priority": "critical",
      "description": "Auto-create feature branches when running Ralph on protected branches",
      "steps": [
        "Add AUTO_CREATE_BRANCH configuration (default: true)",
        "When on protected branch, inspect PRD to select next feature",
        "Auto-create branch using conventional naming: feature/{id}-{slug}, bugfix/{id}-{slug}, etc.",
        "Use PRD 'type' field to determine prefix (feature/, bugfix/, refactor/, chore/)",
        "Fallback to feature/{timestamp} if type unknown or generic work",
        "Switch to new branch before running agent",
        "Show user what branch was created and why",
        "Add --branch-name parameter to override auto-generated name",
        "Document the workflow in README with examples",
        "Test: run on main, verify branch created with correct prefix, verify work proceeds"
      ],
      "estimated_complexity": "small",
      "depends_on": [],
      "passes": true,
      "iterations_taken": 1,
      "blocked_reason": null
    },
    {
      "id": "000",
      "type": "feature",
      "category": "infrastructure",
      "priority": "critical",
      "description": "Add git safety checks to prevent commits to main and accidental pushes",
      "steps": [
        "Add PROTECTED_BRANCHES configuration (default: main,master)",
        "Add branch check before allowing commits",
        "Prevent Ralph from operating on protected branches",
        "Add ALLOW_GIT_PUSH configuration (default: false)",
        "Block all git push operations unless explicitly enabled",
        "Add helpful error messages when on wrong branch",
        "Add suggestion to create feature branch",
        "Test with main branch (should block)",
        "Test with feature branch (should allow)",
        "Document branch safety in README"
      ],
      "estimated_complexity": "small",
      "depends_on": [],
      "passes": true,
      "iterations_taken": 1,
      "blocked_reason": null
    },
    {
      "id": "001",
      "type": "feature",
      "category": "infrastructure",
      "priority": "high",
      "description": "Add branch strategy for feature branches",
      "steps": [
        "Add BRANCH_STRATEGY configuration to ralph.sh (none|feature|pr)",
        "Implement automatic branch creation per feature",
        "Add branch naming convention (ralph/feature-{id}-{slug})",
        "Implement automatic git checkout to feature branch",
        "Add option to create PR automatically after feature completion",
        "Test with github CLI integration",
        "Update documentation with branch strategy examples"
      ],
      "estimated_complexity": "large",
      "depends_on": [
        "000",
        "000a"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "002",
      "type": "feature",
      "category": "infrastructure",
      "priority": "medium",
      "description": "Add support for parallel work streams",
      "steps": [
        "Design stream concept (separate PRD sections or files)",
        "Add --stream parameter to ralph.sh",
        "Implement stream filtering in feature selection",
        "Add stream tags to prd.json schema",
        "Create example multi-stream PRD",
        "Document parallel workflow patterns",
        "Add conflict detection between streams"
      ],
      "estimated_complexity": "large",
      "depends_on": [
        "000"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "003",
      "type": "feature",
      "category": "testing",
      "priority": "high",
      "description": "Enhanced test strategy with explicit acceptance criteria",
      "steps": [
        "Add acceptance_criteria object to PRD schema",
        "Include unit_tests, e2e_tests, manual_checks arrays",
        "Update AGENT_PROMPT to check acceptance criteria",
        "Modify ralph.sh to verify specific test files exist and pass",
        "Add test coverage reporting",
        "Create template with acceptance criteria examples",
        "Update INITIALIZER_PROMPT to generate acceptance criteria"
      ],
      "estimated_complexity": "medium",
      "depends_on": [
        "000"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "004",
      "type": "feature",
      "category": "infrastructure",
      "priority": "medium",
      "description": "CI/CD integration with GitHub Actions",
      "steps": [
        "Add WAIT_FOR_CI configuration option to ralph.sh",
        "Implement GitHub Actions status check via gh CLI",
        "Add automatic waiting for CI to complete",
        "Implement auto-rollback if CI fails",
        "Add CI status to progress log",
        "Create example .github/workflows/ralph-ci.yml",
        "Document CI integration patterns"
      ],
      "estimated_complexity": "medium",
      "depends_on": [
        "001"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "005",
      "type": "feature",
      "category": "quality",
      "priority": "low",
      "description": "Feature estimation tracking and analytics",
      "steps": [
        "Implement automatic tracking of actual vs estimated complexity",
        "Add analytics command to ralph.sh (--stats)",
        "Generate report of estimation accuracy",
        "Track average iterations per complexity level",
        "Identify frequently blocked features",
        "Create visualization of progress over time",
        "Add learning notes based on estimation patterns"
      ],
      "estimated_complexity": "medium",
      "depends_on": [
        "000"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "006",
      "type": "feature",
      "category": "infrastructure",
      "priority": "low",
      "description": "Ralph configuration profiles",
      "steps": [
        "Create .ralph/config.sh or .ralph/config.json format",
        "Add support for loading configuration from file",
        "Define default profiles (learning, production, fast)",
        "Implement profile switching (--profile parameter)",
        "Add profile inheritance and overrides",
        "Create example profiles for common use cases",
        "Document profile system in README"
      ],
      "estimated_complexity": "small",
      "depends_on": [
        "000"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "007",
      "type": "refactor",
      "category": "quality",
      "priority": "medium",
      "description": "Improve ralph.sh error handling and logging",
      "steps": [
        "Add structured logging with log levels (DEBUG, INFO, WARN, ERROR)",
        "Implement LOG_FILE option for persistent logs",
        "Add better error messages with suggestions",
        "Implement graceful degradation for missing tools",
        "Add --verbose and --quiet flags",
        "Create troubleshooting guide based on common errors",
        "Add health check command (ralph.sh --doctor)"
      ],
      "estimated_complexity": "medium",
      "depends_on": [
        "000"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "008",
      "type": "test",
      "category": "testing",
      "priority": "high",
      "description": "Create test suite for ralph.sh script",
      "steps": [
        "Set up bash testing framework (bats or similar)",
        "Write tests for configuration loading",
        "Write tests for feature selection logic",
        "Write tests for error recovery and rollback",
        "Write tests for dependency checking",
        "Create mock PRD files for testing",
        "Add CI workflow to run tests on changes"
      ],
      "estimated_complexity": "large",
      "depends_on": [
        "001",
        "003"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "009",
      "type": "feature",
      "category": "documentation",
      "priority": "high",
      "description": "Update all documentation to explain new features",
      "steps": [
        "Update README.md with error recovery section",
        "Document new PRD schema fields (type, depends_on, etc)",
        "Add examples of dependency chains",
        "Document rollback configuration options",
        "Add troubleshooting section for common issues",
        "Create migration guide from v1 to v2 schema",
        "Update QUICK_REFERENCE with new field meanings"
      ],
      "estimated_complexity": "medium",
      "depends_on": [
        "001",
        "002",
        "003",
        "004",
        "005",
        "006",
        "007"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "010",
      "type": "feature",
      "category": "quality",
      "priority": "critical",
      "description": "Enhance code quality checks: ensure linting, prettier, and TypeScript pass before completion",
      "steps": [
        "Update AGENT_PROMPT.md to explicitly require lint/format/typecheck before marking complete",
        "Add verification step checklist in agent prompt",
        "Update run_verification_tests() in ralph.sh to check prettier formatting",
        "Add option to auto-fix prettier issues (AUTOFIX_PRETTIER config)",
        "Ensure TypeScript errors block feature completion",
        "Make linting errors block completion (not just warnings)",
        "Add clear error messages showing which quality check failed",
        "Document the quality gate requirements in README",
        "Test that features cannot be marked complete with quality issues"
      ],
      "estimated_complexity": "medium",
      "depends_on": [
        "000"
      ],
      "passes": true,
      "iterations_taken": 1,
      "blocked_reason": null
    },
    {
      "id": "011",
      "type": "feature",
      "category": "quality",
      "priority": "high",
      "description": "Optimize test output to only show failing tests to conserve tokens",
      "steps": [
        "Update run_verification_tests() to capture full test output",
        "Parse test output to identify only failing tests",
        "Display only failing test details in agent context",
        "Show test summary statistics (passed/failed counts)",
        "Add configuration option TEST_OUTPUT_MODE (full|failures|summary)",
        "Implement for npm test, pnpm test, and common test runners",
        "Add support for Jest, Vitest, Mocha output formats",
        "Document token savings achieved",
        "Add examples to README showing token optimization"
      ],
      "estimated_complexity": "medium",
      "depends_on": [
        "010"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "012",
      "type": "feature",
      "category": "infrastructure",
      "priority": "medium",
      "description": "Add sandboxed execution mode for enhanced security",
      "steps": [
        "Research container/VM isolation options (Docker, Firecracker, gVisor)",
        "Add SANDBOX_MODE configuration option (none|docker|vm)",
        "Implement Docker-based sandbox execution",
        "Add permission restrictions and blast radius limiting",
        "Configure network isolation options",
        "Add file system access restrictions",
        "Implement cleanup of sandbox environments after runs",
        "Document security considerations and setup",
        "Provide examples for GCP VM and Docker setups",
        "Add warnings about running with full permissions"
      ],
      "estimated_complexity": "large",
      "depends_on": [
        "000"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "013",
      "type": "feature",
      "category": "infrastructure",
      "priority": "medium",
      "description": "Add Sanity CMS schema for PRD storage",
      "steps": [
        "Create Sanity schema definition for PRD structure",
        "Define document types for features, projects, and field definitions",
        "Add validation rules matching current JSON schema",
        "Create migration script from JSON to Sanity documents",
        "Set up basic Sanity client configuration",
        "Add SANITY_PROJECT_ID and SANITY_DATASET to ralph.sh config",
        "Document Sanity setup in README"
      ],
      "estimated_complexity": "small",
      "depends_on": [
        "000"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "014",
      "type": "feature",
      "category": "infrastructure",
      "priority": "medium",
      "description": "Implement Sanity read/write operations for PRD",
      "steps": [
        "Add PRD_STORAGE configuration (file|sanity|hybrid)",
        "Implement fetch_prd_from_sanity() function",
        "Implement update_prd_in_sanity() function",
        "Add caching layer for Sanity queries",
        "Handle authentication with Sanity API tokens",
        "Add error handling for network/API failures",
        "Implement fallback to local file if Sanity unavailable",
        "Add sync status tracking",
        "Test round-trip read/write operations"
      ],
      "estimated_complexity": "medium",
      "depends_on": [
        "013"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "015",
      "type": "feature",
      "category": "infrastructure",
      "priority": "low",
      "description": "Add bi-directional sync between local PRD and Sanity",
      "steps": [
        "Implement conflict detection (local vs remote changes)",
        "Add sync command (ralph.sh --sync)",
        "Implement push changes to Sanity",
        "Implement pull changes from Sanity",
        "Add merge strategies (local-wins, remote-wins, manual)",
        "Track last sync timestamp",
        "Add sync status to progress log",
        "Document sync workflows and conflict resolution"
      ],
      "estimated_complexity": "medium",
      "depends_on": [
        "014"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    },
    {
      "id": "016",
      "type": "feature",
      "category": "infrastructure",
      "priority": "low",
      "description": "Create Sanity Studio UI for PRD management",
      "steps": [
        "Set up Sanity Studio project structure",
        "Create custom input components for PRD fields",
        "Add visual dependency graph view",
        "Implement drag-and-drop priority ordering",
        "Add filtering and search capabilities",
        "Create dashboard showing progress metrics",
        "Add real-time collaboration indicators",
        "Document Studio deployment options",
        "Create screenshot examples for README"
      ],
      "estimated_complexity": "large",
      "depends_on": [
        "015"
      ],
      "passes": false,
      "iterations_taken": 0,
      "blocked_reason": null
    }
  ],
  "notes": [
    "This PRD uses Ralph to improve Ralph itself (meta!)",
    "Feature 000a solves chicken-and-egg: auto-create branches so you can run Ralph on main (CRITICAL)",
    "Feature 000 implements git safety checks (COMPLETE)",
    "Feature 010 ensures code quality gates (lint/prettier/typescript) are enforced (COMPLETE)",
    "Features 001-006 implement the remaining improvements from the analysis",
    "Feature 007 improves code quality of ralph.sh",
    "Feature 008 adds proper testing infrastructure",
    "Feature 009 documents all the new features",
    "Feature 011 optimizes token usage by showing only failing tests",
    "Feature 012 adds sandboxed execution for enhanced security",
    "Features 013-016 add Sanity CMS integration for PRD storage",
    "Sanity integration is broken into 4 progressively complex features",
    "Start with features that have no dependencies",
    "Use human-in-the-loop mode for complex features",
    "Switch to continuous mode once confident with the patterns"
  ],
  "field_definitions": {
    "type": "Type of work - 'feature' (new functionality), 'bug' (fix), 'refactor' (improve code), 'test' (add tests)",
    "category": "Category - 'setup', 'infrastructure', 'functional', 'testing', 'quality', 'documentation'",
    "priority": "Priority - 'critical', 'high', 'medium', 'low'",
    "estimated_complexity": "Estimated size - 'small' (< 1hr), 'medium' (1-3hrs), 'large' (> 3hrs)",
    "depends_on": "Array of feature IDs that must be completed before this one",
    "passes": "Boolean - true when fully implemented and verified",
    "iterations_taken": "Number of Ralph iterations needed to complete (tracked automatically)",
    "blocked_reason": "String - if blocked, explain why (null if not blocked)"
  }
}
